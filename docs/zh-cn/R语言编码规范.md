# R语言开发规范


---

## **1. 代码结构和格式**
### **1.1 缩进**
- 使用 2 个空格作为缩进，不使用制表符（Tab）。
- 每行代码长度尽量控制在 **80-100 字符**以内。

### **1.2 空格**
- 操作符（如 `=`、`<-`、`+` 等）两侧使用空格，例如：
  ```r
  x <- 10
  y <- x + 5
  ```
- 函数调用时，函数名和括号之间不加空格，例如：
  ```r
  mean(x)
  ```

### **1.3 注释**
- 单行注释用 `#`，并在符号后加一个空格，例如：
  ```r
  # 这是一个注释
  x <- 42  # 变量赋值
  ```
- 长注释可以用 `#` 行分隔，如：
  ```r
  # ----------------------
  # 数据清洗步骤
  # ----------------------
  ```

---

## **2. 命名规范**
### **2.1 变量和函数命名**
- 使用 **小写字母和下划线**，遵循蛇形命名法（snake_case），例如：
  ```r
  average_score <- 85.5
  compute_mean <- function(x) { mean(x) }
  ```

### **2.2 常量**
- 使用全大写字母，单词之间用下划线分隔，例如：
  ```r
  PI <- 3.14159
  ```

### **2.3 文件和脚本命名**
- 使用描述性名称，遵循蛇形命名法，例如：
  ```
  data_cleaning.R
  model_training.R
  ```

---

## **3. 函数设计**
### **3.1 参数**
- 函数参数命名应具有意义，避免使用单字母（如 `x`）作为参数名，除非在数学或统计背景中合适。
- 参数列表尽量清晰且精简，不宜过长。

### **3.2 返回值**
- 函数应返回单一的、易理解的数据结构，如向量、列表或数据框。
- 避免函数具有副作用（如在函数内直接修改全局变量）。

### **3.3 文档**
- 每个函数应添加文档注释，包括函数功能、参数说明、返回值等：
  ```r
  #' 计算向量的均值
  #' 
  #' @param x 数值型向量
  #' @return 数值型，向量的均值
  #' @examples
  #' compute_mean(c(1, 2, 3))
  compute_mean <- function(x) {
    mean(x)
  }
  ```

---

## **4. 数据处理**
- 避免使用硬编码（如手动输入列名或索引），而是使用函数动态获取。
- 优先使用 `tidyverse` 包（如 `dplyr` 和 `ggplot2`）来处理数据，代码更直观且易读。

---

## **5. 错误处理**
- 在函数中处理异常情况（如参数检查）：
  ```r
  compute_mean <- function(x) {
    if (!is.numeric(x)) {
      stop("参数 x 必须是数值型向量")
    }
    mean(x)
  }
  ```

---

## **6. 项目管理**
### **6.1 项目结构**
- 使用 RStudio 项目（`.Rproj`）管理开发。
- 推荐的项目目录结构：
  ```
  project_name/
  ├── data/       # 数据文件
  ├── R/          # R 脚本
  ├── output/     # 输出文件
  ├── tests/      # 测试脚本
  ├── README.md   # 项目说明
  ├── .Rproj      # RStudio 项目文件
  ```

### **6.2 版本控制**
- 使用 Git 管理代码版本。
- 提交信息清晰、简洁，例如：
  ```
  添加数据清洗模块
  修复模型训练中的一个错误
  ```

---

## **7. 测试**
- 使用 `testthat` 包编写单元测试，确保函数正确性：
  ```r
  library(testthat)

  test_that("compute_mean 计算正确", {
    expect_equal(compute_mean(c(1, 2, 3)), 2)
  })
  ```

---

## **8. 代码性能优化**
- 优先使用矢量化操作，避免显式循环：
  ```r
  # 不推荐
  result <- numeric(length(x))
  for (i in seq_along(x)) {
    result[i] <- x[i]^2
  }

  # 推荐
  result <- x^2
  ```

- 在需要优化性能时，可以考虑使用 `data.table` 或 `Rcpp`。

---

## **9. 可视化**
- 使用一致的样式和主题，如 `ggplot2` 中统一设置主题：
  ```r
  library(ggplot2)
  ggplot(data, aes(x, y)) +
    geom_point() +
    theme_minimal()
  ```

---

## **10. 文档和协作**
- 使用 `roxygen2` 生成文档。
- 编写项目说明文件（如 `README.md`）来解释项目目的、依赖、使用方法等。

--- 



